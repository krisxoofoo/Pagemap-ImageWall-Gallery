/*
 *  Project: S Gallery 
 *  Description: Responsive jQuery Gallery Plugin with CSS3 Animations inspired by http://store.sony.com/webapp/wcs/stores/servlet/ProductDisplay?catalogId=10551&storeId=10151&langId=-1&productId=8198552921666556433#gallery
 *  Author: Sara Soueidan
 *  License: Creative-Commons Attribution Non-Commercial
 */
(function(e,t,n,r){function o(r,o){this.element=r;this.galleryContainer=e(this.element);this.bigItemsList=this.galleryContainer.children("ul:eq(1)");this.bigItem=this.bigItemsList.children("li");this.options=e.extend({},s,o);this._defaults=s;this._name=i;this.current="";this.slideshow=false;this.initialHeight="auto";this.isFullScreen=false;this.$controls=e(".controls");this.$control=e(".control");this.$grid=e(".grid");this.$fsButton=e(".fs-toggle");this.$document=e(n);this.$window=e(t);this.init()}var i="sGallery",s={fullScreenEnabled:false};o.prototype={init:function(){var e=this,t=this.galleryContainer.find("ul:eq(0)"),n=t.children("li"),r=this.bigItem.length,i=this.options;this.setDelays(t);this.bindListHandler(t);this.handleQuit();this.controlSlideShow(r);if(i.fullScreenEnabled){this.controlFullScreen()}this.changeOnResize()},changeOnResize:function(){var e=this;this.$window.load(function(){e.$window.resize(function(){e.initialHeight=e.galleryContainer.outerHeight();e.minHeight=e.bigItem.height()+parseInt(e.bigItem.css("top"))+e.$controls.height()*2;console.log("window resize");e.adaptHeight()});e.$window.trigger("resize")})},setDelays:function(t){t.children("li").each(function(t){e(this).css("animation-delay",.075*t+"s")})},bindListHandler:function(t){var n=this;t.on("click","li",function(t){t.preventDefault();var r=e(this);n.current=r.index();n.fadeAllOut();n.showControls();n.slideshow=true;startImg=n.bigItemsList.children("li:eq("+n.current+")");r.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(e){startImg.addClass("fadeInScaleUp").removeClass("fadeOut");n.adaptHeight()})})},adaptHeight:function(){var t=this,n=this.bigItem.outerHeight();if(t.slideshow&&t.initialHeight<t.minHeight){e(t.element).animate({height:t.minHeight+"px"},0);console.log("adapting height first if")}else if(t.slideshow&&t.initialHeight>t.minHeight){e(this.element).animate({height:t.minHeight+"px"},0);console.log("adapting height second if")}},fadeAllOut:function(){this.galleryContainer.children("ul:eq(0)").children("li").removeClass("scaleUpFadeIn").removeClass("showLastSecond").addClass("scaleDownFadeOut")},fadeAllIn:function(){var e=this;var t=this.galleryContainer.children("ul:eq(0)").children("li:eq("+e.current+")");this.galleryContainer.children("ul:eq(0)").children("li").not(t).removeClass("scaleDownFadeOut").addClass("scaleUpFadeIn");t.removeClass("scaleDownFadeOut").addClass("showLastSecond")},showControls:function(){this.$controls.addClass("showControls").removeClass("hideControls")},hideControls:function(){this.$controls.addClass("hideControls").removeClass("showControls")},controlSlideShow:function(n){var r=this,i;this.$document.on("keydown",function(e){var e=e||t.event;i=e.keyCode;if(i==37&&r.slideshow){r.current--;if(r.current<0){r.current=n-1}r.moveToNextImage()}else if(i==39&&r.slideshow){r.current++;if(r.current==n){r.current=0}r.moveToNextImage()}});this.$control.on("click",function(){var t=e(this).data("direction");t=="next"?r.current++:r.current--;if(r.current<0){r.current=n-1}else if(r.current==n){r.current=0}r.moveToNextImage()})},moveToNextImage:function(){var t=this;var n=this.bigItemsList.children("li:eq("+t.current+")").addClass("fadeInScaleUp").siblings("li").filter(".fadeInScaleUp").removeClass("fadeInScaleUp").addClass("fadeOut").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(t){e(this).removeClass("fadeOut")})},handleQuit:function(){var e=this;this.$document.on("keydown",function(n){var n=n||t.event;key=n.keyCode;if(key==16&&e.slideshow){e.quitSlideShow()}});this.$grid.on("click",function(){e.quitSlideShow()})},controlFullScreen:function(){var t=this,n=this.element;this.$fsButton.css("display","inline-block").on("click",function(){if(screenfull.enabled){screenfull.toggle(n);if(!t.isFullScreen){e(this).removeClass("icon-fullscreen").addClass("icon-fullscreen-exit");t.isFullScreenfull=true}else{e(this).removeClass("icon-fullscreen-exit").addClass("icon-fullscreen");t.isFullScreen=false}}else{return false}})},quitSlideShow:function(t){this.hideControls();this.fadeAllIn();this.slideshow=false;var n=this;if(!this.isFullScreen){this.galleryContainer.animate({height:n.initialHeight},0,function(){e(this).css("height","auto")})}var r=this.galleryContainer.children("ul:eq(1)").children("li:eq("+n.current+")"),i=this.galleryContainer.children("ul:eq(0)").children("li:eq("+n.current+")"),s=i.height(),o=i.width(),u=i.position().left,a=i.position().top,f=parseFloat(i.css("animation-delay")),l=parseFloat(i.css("animation-duration")),c=f+l;r.children("img").andSelf().animate({height:s,width:o,left:u+"px",top:a+"px"},c*1e3,function(){e(this).removeClass("fadeInScaleUp").removeAttr("style")})}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)