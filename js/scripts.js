/*
 *  Project: S Gallery 
 *  Description: Responsive jQuery Gallery Plugin with CSS3 Animations inspired by http://store.sony.com/webapp/wcs/stores/servlet/ProductDisplay?catalogId=10551&storeId=10151&langId=-1&productId=8198552921666556433#gallery
 *  Author: Sara Soueidan
 *  License: Creative-Commons Attribution Non-Commercial
 Customized: added number of image, for added captions in the HTML, these are hidden while image resizes
 */
(function(e,c,a,g){var d="sGallery",f={fullScreenEnabled:false};function b(i,h){this.element=i;this.galleryContainer=e(this.element);this.bigItemsList=this.galleryContainer.children("ul:eq(1)");this.bigItem=this.bigItemsList.children("li");this.options=e.extend({},f,h);this._defaults=f;this._name=d;this.current="";this.slideshow=false;this.count=this.bigItem.length;this.initialHeight="auto";this.isFullScreen=false;this.$controls=e(".controls");this.$control=e(".control");this.$grid=e(".grid");this.$fsButton=e(".fs-toggle");this.$document=e(a);this.$window=e(c);this.init()}b.prototype={init:function(){var j=this,i=this.galleryContainer.find("ul:eq(0)"),k=i.children("li"),h=this.options;this.setDelays(i);this.bindListHandler(i);this.handleQuit();this.controlSlideShow(this.count);if(h.fullScreenEnabled){this.controlFullScreen()}this.changeHeight();this.handleTouch()},handleTouch:function(){var j=this;this.bigItem.on("dragstart",function(k){k.preventDefault()});var i=Hammer(this.element).on("swipeleft",function(k){if(j.slideshow){j.controlLeftRight("next")}});var h=Hammer(this.element).on("swiperight",function(k){if(j.slideshow){j.controlLeftRight("previous")}})},changeHeight:function(j){var h=this,j=j||0,i=this.bigItemsList.children("li:eq("+h.current+")");this.initialHeight=this.galleryContainer.outerHeight(),this.minHeight=i.height()+parseInt(this.bigItem.css("top"))+this.$controls.height()*2;this.adaptHeight(j);this.$window.load(function(){h.$window.resize(function(){h.initialHeight=h.galleryContainer.outerHeight();h.minHeight=h.bigItem.height()+parseInt(h.bigItem.css("top"))+h.$controls.height()*2;h.adaptHeight(j)});h.$window.trigger("resize")})},adaptHeight:function(j){var i=this,h=this.bigItem.outerHeight();if(i.slideshow&&i.initialHeight<i.minHeight){e(i.element).animate({height:i.minHeight+"px"},j)}else{if(i.slideshow&&i.initialHeight>i.minHeight){e(this.element).animate({height:i.minHeight+"px"},j)}}},setDelays:function(h){h.children("li").each(function(i){e(this).css("animation-delay",0.075*i+"s")})},bindListHandler:function(h){var i=this;h.on("click","li",function(l){l.preventDefault();var k=e(this);i.current=k.index();i.fadeAllOut();i.showControls();i.slideshow=true;startImg=i.bigItemsList.children("li:eq("+i.current+")");var j=i.current+1;k.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(m){startImg.addClass("fadeInScaleUp").removeClass("fadeOut");i.bigItemsList.css("pointer-events","auto");i.changeHeight(600)})})},fadeAllOut:function(){this.galleryContainer.children("ul:eq(0)").children("li").removeClass("scaleUpFadeIn").removeClass("showLastSecond").addClass("scaleDownFadeOut")},fadeAllIn:function(){var h=this;var i=this.galleryContainer.children("ul:eq(0)").children("li:eq("+h.current+")");this.galleryContainer.children("ul:eq(0)").children("li").not(i).removeClass("scaleDownFadeOut").addClass("scaleUpFadeIn");i.removeClass("scaleDownFadeOut").addClass("showLastSecond")},showControls:function(){this.$controls.addClass("showControls").removeClass("hideControls")},hideControls:function(){this.$controls.addClass("hideControls").removeClass("showControls")},controlSlideShow:function(j){var i=this,h;this.$document.on("keydown",function(k){var k=k||c.event;h=k.keyCode;if(h==37&&i.slideshow){i.current--;if(i.current<0){i.current=j-1}i.moveToNextImage()}else{if(h==39&&i.slideshow){i.current++;if(i.current==j){i.current=0}i.moveToNextImage()}}});this.$control.on("click",function(){var k=e(this).data("direction");i.controlLeftRight(k)})},controlLeftRight:function(h){var h=h;(h=="next")?this.current++:this.current--;if(this.current<0){this.current=this.count-1}else{if(this.current==this.count){this.current=0}}this.moveToNextImage()},moveToNextImage:function(){var i=this;var j=this.bigItemsList.children("li:eq("+i.current+")");var h=this.current+1;j.addClass("fadeInScaleUp").siblings("li").filter(".fadeInScaleUp").removeClass("fadeInScaleUp").addClass("fadeOut").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(k){e(this).removeClass("fadeOut")});this.changeHeight(600)},handleQuit:function(){var h=this;this.$document.on("keydown",function(i){var i=i||c.event;key=i.keyCode;if(key==16&&h.slideshow){h.quitSlideShow()}});this.$grid.on("click",function(){h.quitSlideShow()})},controlFullScreen:function(){var i=this,h=this.element;this.$fsButton.css("display","inline-block").on("click",function(){if(screenfull.enabled){screenfull.toggle(h);if(!i.isFullScreen){e(this).removeClass("icon-fullscreen").addClass("icon-fullscreen-exit");i.isFullScreenfull=true}else{e(this).removeClass("icon-fullscreen-exit").addClass("icon-fullscreen");i.isFullScreen=false}}else{return false}})},quitSlideShow:function(p){this.hideControls();this.fadeAllIn();this.slideshow=false;var o=this;if(!this.isFullScreen){this.galleryContainer.animate({height:o.initialHeight},0,function(){e(this).css("height","auto")})}this.bigItemsList.css("pointer-events","none");var k=this.galleryContainer.children("ul:eq(1)").children("li:eq("+o.current+")"),h=this.galleryContainer.children("ul:eq(0)").children("li:eq("+o.current+")"),r=h.height()-h.find(".item-price").height(),i=h.width(),j=h.position().left,q=h.position().top,m=parseFloat(h.css("animation-delay")),l=parseFloat(h.css("animation-duration")),n=m+l;k.find(".img-caption").css("opacity","0");k.children("img").andSelf().animate({height:r,width:i,left:j+"px",top:q+"px"},n*1000,function(){e(this).removeClass("fadeInScaleUp").removeAttr("style");k.find(".img-caption").css("opacity","1")})}};e.fn[d]=function(h){return this.each(function(){if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new b(this,h))}})}})(jQuery,window,document);